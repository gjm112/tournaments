---
title: "Assessing Ranking Fidelity of Competition Structures via Weighted Mutual Information"
author: "Zach Culp, Josie Peterburs, Dr. Gregory J. Matthews, Dr. Ryan P.A. McShane"
format: 
  revealjs: 
    embed-resources: true
    theme: [default, styles.scss]
    # theme: [serif, styles.scss]
    html-math-method: 
      method: mathjax
      url: "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    df-print: paged
editor: visual
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tinytex)
library(tidyverse)
library(combinat)
library(knitr)
library(kableExtra)
load("curves_data.RData")
#load("tournament_comparison_plot.png")
#load("tournament_comparison_plot_close.png")
```

## 

:::::::::: columns
::::::: {.column width="40%"}
::: fragment
```{r}
knitr::include_graphics("Mens-Basketball-Olympics-Getty-H-2024.jpeg")
```
:::

::: fragment
```{r}
knitr::include_graphics("five_babies_playing_basketball.png")
```
:::

::: fragment
```{r}
knitr::include_graphics("jv_girls_basketball.png")
```
:::

::: fragment
```{r}
knitr::include_graphics("five_rec_league_men_playing_basketball.png")
```
:::
:::::::

:::: {.column width="60%"}
::: fragment
```{r, out.width="80%"}
knitr::include_graphics("4 bracket good.png")
```
:::
::::
::::::::::

## 

::::: columns
::: {.column width="50%"}
Good
:::

::: {.column width="50%"}
Bad
:::
:::::

```{r}
knitr::include_graphics("4 seeded tourn w arrow.png")
```

::: notes
-   4 team single elimination tournament:
    -   Dream Team vs Work Group vs Middle School Girls Team vs Babies
-   If we only care about the top team winning, seeding structure does not matter
-   If we care about who gets second and third, seeding becomes important
    -   Would not pair up Work Group and Dream Team in the first round
:::

## Distribution of $\hat{r}$

```{r}
knitr::include_graphics("rhat_dist.png")
```

## Comparing Structures

-   Which competition structure is best?

    ::: incremental
    -   What is considered "best"?

    -   A good tournament: top *k* teams produced by the tournament matches closely to the true top *k*
    :::

## Comparing Structures

-   Which competition structure is best?

    -   What is considered "best"?

    -   A good tournament: top *k* teams produced by the tournament matches closely to the true top *k*

-   **Effectivity**[^1]: Interested in correctly ranking the best competitor as first

-   **Efficacy**[^2]: Final rankings should match the true rankings of all the competitors

[^1]: Glenn (1960)

[^2]: Lasek and Gagolewsk (2018), Sziklai, Biró, and Csató (2022)

## Effectivity and Efficacy

```{r}
knitr::include_graphics("salient bar.png")
```

## Effectivity and Efficacy

```{r, out.width="100%"}
knitr::include_graphics("salient examples.png")
```

::: fragment
-   **Salient ranks**: output ranks of the tournament you want to get correct
    -   Effectivity: 1 is only salient rank (*k*=1)
    -   Efficacy: 1 through $n$ are salient ranks (*k*=n)
:::

## Goal

-   Quantify how well a structure can accurately order the competitors using weighted mutual information
-   We propose a metric that quantifies how effectively different tournament structures recover the true ranking of the teams

## Mutual Information

::: notes
If one views the true ranking of the teams in a competition as a message to be sent to a receiver and the outcome of the competition as a message that is received, we can measure the "goodness" of a competition in terms of its ability to accurately transmit the true ranking.
:::

-   The notation for mutual information is: $$ I(X;Y) = \sum_{y \in Y}\sum_{x \in X} p(x,y) \log{\frac{p(x,y)}{p(x)p(y)}} $$

-   In our case, it can be simplified to:

    $$ I(r, \hat{r}) = n! \sum_{\hat{r}} p(r, \hat{r}) \log{\frac{p(r,\hat{r})}{(\frac{1}{n!})^2}} $$

## Weighted Mutual Information

-   A limitation of mutual information is that it does not distinguish between the direction of information
-   Given equal probabilities, the information found from a ranking of $(1,2,3,4)$ is equivalent to $(4,3,2,1)$
-   Because of this, we proposed a new weighting function\
    $$ I_w(r,\hat{r}) = \sum_r \sum_{\hat{r}} w(r,\hat{r}) * p(r, \hat{r}) \log{\frac{p(r,\hat{r})}{p(r)p(\hat{r})}} $$
-   The final metric we used normalizes the results: $\frac{I_w(r,\hat{r})}{H(r,\hat{r})}$

## Top K-teams Weighted Kendall

```{r}
# Get the filtered data
#table_data <- rhat_df %>% 
#  select(-squared_error) %>%   
#  filter(permutation %in% c("1234", "4321", "1324", "2143")) %>%   
#  arrange(permutation, k) %>%   
#  rename("Weighted Kendall" = weighted_kendall)

# Split into two halves
#n <- nrow(table_data)
#left_table <- table_data %>% head(ceiling(n/2))
#right_table <- table_data %>% tail(floor(n/2))

# Create side-by-side tables
#left_html <- left_table %>% 
#  kable(format = "html", row.names = FALSE) %>% 
#  kableExtra::kable_styling(font_size = 24)

#right_html <- right_table %>% 
#  kable(format = "html", row.names = FALSE) %>% 
#  kableExtra::kable_styling(font_size = 24)
knitr::include_graphics("Top_k_Kendall.png")

```

## Tournament Simulations

-   Given the assigned "known strength", $\theta$, we simulate a game using: $\Pr(i > j) = \frac{e^{\theta_i}}{e^{\theta_i} + e^{\theta_j}} = \frac{1}{1+e^{\theta_i - \theta_j}}$

```{r}
renamed_df <- single_run_example %>%    
  select(-c(distribution, seed)) %>%   
  rename(theta = true_strength, r = true_rank, r_hat = rank_hat, "Wins" = game_wins, "Losses" = game_losses) %>%   
  mutate(theta = round(theta,3))

# Create side-by-side tables
html_df <- renamed_df %>% 
  kable(format = "html", row.names = FALSE) %>% 
  kableExtra::kable_styling(font_size = 24)

```

::::: columns
::: {.column width="37%"}
```{r}
#| echo: false
html_df
```
:::

::: {.column width="63%"}
```{r}
#| echo: false
#| out-width: "125%"
#| out-length: "150%"
#| fig-width: 8
#| fig-height: 16
knitr::include_graphics("simulation_example.png")
```
:::
:::::

## Results

:::::: {style="position: relative;"}
::: {.fade-out fragment-index="1"}
```{r out.width="60%", fig.show='hold', fig.align='center'}
knitr::include_graphics("boxed_tournament_comparison_plot.png")
```
:::

::: {.fragment .fade-in .fade-out fragment-index="1" fragment-index="2" style="position: absolute; top: 50%; left: 0; right: 0; transform: translateY(-50%);"}
```{r out.width="60%", fig.show='hold', fig.align='center'}
knitr::include_graphics("tournament_comparison_plot.png")
```
:::

::: {.fragment .fade-in fragment-index="2" style="position: absolute; top: 50%; left: 0; right: 0; transform: translateY(-50%);"}
```{r out.width="60%", fig.show='hold', fig.align='center'}
knitr::include_graphics("tournament_comparison_plot_close.png")
```
:::
::::::

## Discussion

-   We used mutual information to analyze competition structures in a range from efficacy to effectivity.
-   Using the method, we found that Round Robin is the best structure, followed by Reseeded Single Elimination, Double Elimination, and Group Stage.
-   Limitations: The "known" ranks are assigned using $\theta$ and, for some structure, the order of the ranks matter in the formatting of the structure
-   Future Work: Examine how the distribution of $\theta$s influence the score of each competition structure

## References

<!-- ## References {.smaller} -->

-   Appleton, David R. 1995. “May the Best Man Win?” Statistician 44 (4): 529.
-   Csato, L. 2021. Tournament Design: How Operations Research Can Improve Sports Rules. 1st Ed. Cham, Switzerland: Palgrave Macmillan.
-   Devriesere, Csató, K., and D. Goossens. 2025. “Tournament Design: A Review from an Operational Research Perspective.” European Journal of Operational Research 324 (1): 1–21.
-   Glenn, W A. 1960. “A Comparison of the Effectiveness of Tournaments.” Biometrika 47 (3-4): 253–62.

## References

-   Guiasu, Silviu. 1977. Information Theory with Applications. New York, NY: McGraw-Hill.
-   Johnson, Sidney, and Rodney Fort. 2022. “Match Outcome Uncertainty and Sports Fan Demand: An Agnostic Review and the Standard Economic Theory of Ports Leagues.” Int. J. Emp. Econ. 01 (02).
-   Lasek, Jan, and Marek Gagolewski. 2018. “The Efficacy of League Formats in Ranking Teams.” Stat. Modelling 18 (5-6): 411–35.
-   Sziklai, Balázs R, Péter Biró, and László Csató. 2022. “The Efficacy of Tournament Designs.” Comput. Oper. Res. 144 (105821): 105821.
