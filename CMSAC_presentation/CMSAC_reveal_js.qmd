---
title: "Assessing Ranking Fidelity of Competition Structures via Weighted Mutual Information"
author: "Zach Culp, Josie Peterburs, Dr. Gregory J. Matthews, Dr. Ryan P.A. McShane"
format: 
  revealjs: 
    df-print: paged
editor: visual
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tinytex)
library(tidyverse)
library(combinat)
library(knitr)
library(kableExtra)
load("curves_data.RData")
#load("tournament_comparison_plot.png")
#load("tournament_comparison_plot_close.png")
```

## 

:::::::::: columns
::::::: {.column width="40%"}
::: fragment
```{r}
knitr::include_graphics("Mens-Basketball-Olympics-Getty-H-2024.jpeg")
```
:::

::: fragment
```{r}
knitr::include_graphics("five_babies_playing_basketball.png")
```
:::

::: fragment
```{r}
knitr::include_graphics("jv_girls_basketball.png")
```
:::

::: fragment
```{r}
knitr::include_graphics("five_rec_league_men_playing_basketball.png")
```
:::
:::::::

:::: {.column width="60%"}
::: fragment
```{r, out.width="80%"}
knitr::include_graphics("4 bracket good.png")
```
:::
::::
::::::::::

## 

::::: columns
::: {.column width="50%"}
Good
:::

::: {.column width="50%"}
Bad
:::
:::::

```{r}
knitr::include_graphics("4 seeded tourn w arrow.png")
```

::: notes
-   4 team single elimination tournament:
    -   Dream Team vs Work Group vs Middle School Girls Team vs Babies
-   If we only care about the top team winning, seeding structure does not matter
-   If we care about who gets second and third, seeding becomes important
    -   Would not pair up Work Group and Dream Team in the first round
:::

## Distribution of $\hat{r}$


```{r}
knitr::include_graphics("rhat_dist.png")
```

## Comparing Structures
::: {.incremental}
-   Which competition structure is best?

    -   What is considered "best"?

-   **Efficacy**[^1]: Final rankings should match the true rankings of the strength of the competitors

-   **Effectivity**[^2]: Interested in correctly ranking the best competitor as first
:::

::: {.fragment}
```{r}
knitr::include_graphics("salient bar.png")
```


[^1]: Lasek and Gagolewsk (2018), Sziklai, Biró, and Csató (2022)

[^2]: Glenn (1960)

:::

## Efficacy and Effectivity

```{r}
knitr::include_graphics("salient examples.png")
```

-   **Salient ranks**: output ranks of the tournament you want to get correct
    -   Efficacy: 1 through $n$ matter
    -   Effectivity: 1 is only salient rank

## Goal

-   Want to quantify how well a structure can accurately order the competitors
-   We propose a metric that quantifies how effectively different tournament structures recover the true ranking

## Mutual Information

::: notes
If one views the true ranking of the teams in a tournament as a message to be sent to a receiver and the outcome of the tournament as a message that is received, we can measure the "goodness" of a tournament in terms of its ability to accurately transmit the true ranking.
:::

-   The notation for mutual information is: $$ I(X;Y) = \sum_{y \in Y}\sum_{x \in X} p(x,y) \log{\frac{p(x,y)}{p(x)p(y)}} $$

-   In our case, it can be simplified to:

    $$ I(r, \hat{r}) = n! \sum_{\hat{r}} p(r, \hat{r}) \log{\frac{p(r,\hat{r})}{(\frac{1}{n!})^2}} = n! \log{((n!)^2)} $$

## Weighted Mutual Information

-   A limitation of mutual information is that it does not distinguish between the direction of information
-   In other words, given equal probabilities, a ranking of $(1,2,3,4)$ is equivalent to $(4,3,2,1)$
-   Because of this, we proposed a new weighting function $w(r, \hat{r})$\
    $$ wI_m(r,\hat{r}) = \sum_r \sum_{\hat{r}} w(r,\hat{r}) * p(r, \hat{r}) \log{\frac{p(r,\hat{r})}{p(r)p(\hat{r})}} $$

## Weighting Function

-   In our original paper submission, we used squared error loss as the weighting function: $w(r, \hat{r}) = \begin{cases} \frac{1}{(r-\hat{r})^2}, & r \neq \hat{r} \\ 1, & r = \hat{r} \end{cases}$
-   However, after comments and reviews from people at CSAS and CMSAC, we have decided to use a weighted Kendall's Tau

## Weighted Kendall

$$ \tau_w = \frac{\sum_{i\neq j} W_{ij} \text{ sgn}(i-j) \text{ sgn}(R_i - R_j)}{\sum_{i,j} W_{ij} - \sum_i W_{ii}}$$

-   If $\hat{r} = (2,1,3,4)$, then:

$$\sum_{i\neq j} W_{ij} \text{ sgn}(i-j) \text{ sgn}(R_i - R_j) = 10$$

-   So, $\tau_w$ for this example would be $\frac{10}{15-3} = 0.833$

## Top K-teams Weighted Kendall

```{r}
# Get the filtered data
table_data <- rhat_df %>% 
  select(-squared_error) %>%   
  filter(permutation %in% c("1234", "4321", "1324", "2143")) %>%   
  arrange(permutation, k) %>%   
  rename("Weighted Kendall" = weighted_kendall)

# Split into two halves
n <- nrow(table_data)
left_table <- table_data %>% head(ceiling(n/2))
right_table <- table_data %>% tail(floor(n/2))

# Create side-by-side tables
left_html <- left_table %>% 
  kable(format = "html", row.names = FALSE) %>% 
  kableExtra::kable_styling(font_size = 24)

right_html <- right_table %>% 
  kable(format = "html", row.names = FALSE) %>% 
  kableExtra::kable_styling(font_size = 24)
```

::::: columns
::: {.column width="48%"}
```{r}
#| echo: false
left_html
```
:::

::: {.column width="%48%"}
```{r}
#| echo: false
right_html
```
:::
:::::

$$ \tau_w = \frac{\sum_{i\neq j} W_{ij} \text{ sgn}(i-j) \text{ sgn}(R_i - R_j)}{\sum_{i,j} W_{ij} - \sum_i W_{ii}}$$

## Comparing Weighted Kendall's Tau to Squared Error

```{r}
# Get the filtered data
table_data <- rhat_df %>%    
  filter(k == 4) %>%   
  select(-k) %>%   
  arrange(desc(weighted_kendall)) %>%    
  rename("Weighted Kendall" = weighted_kendall, "Squared Error" = squared_error)

# Split into two halves
n <- nrow(table_data)
left_table <- table_data %>% head(ceiling(n/2))
right_table <- table_data %>% tail(floor(n/2))

# Create side-by-side tables
left_html <- left_table %>% 
  kable(format = "html", row.names = FALSE) %>% 
  kableExtra::kable_styling(font_size = 20)
right_html <- right_table %>% 
  kable(format = "html", row.names = FALSE) %>% 
  kableExtra::kable_styling(font_size = 20)

```

::::: columns
::: {.column width="48%"}
```{r}
#| echo: false
left_html
```
:::

::: {.column width="%48%"}
```{r}
#| echo: false
right_html
```
:::
:::::

## Normalizing Mutual Information

-   To make comparisons across different values of $n$, we normalize by the joint entropy

-   So, the final formula for the metric is:

$$\frac{wI_m(r,\hat{r})}{H(r,\hat{r})} = \frac{\sum_r \sum_{\hat{r}} w(r,\hat{r}) * p(r, \hat{r}) \log{\frac{p(r,\hat{r})}{p(r)p(\hat{r})}}}{\log_2((n!)^2)}$$

-   Assuming $r$ and $\hat{r}$ are independent, joint entropy can be written as $H(r, \hat{r}) = H(r) + H(\hat{r})$

## Tournament Simulations

-   Given the assigned "known strength", $\theta$, we simulate a game using the Bradley-Terry Model: $\Pr(i > j) = \frac{e^{\theta_i}}{e^{\theta_i} + e^{\theta_j}} = \frac{1}{1+e^{\theta_i - \theta_j}}$
-   Below is an example of the output of a single tournament simulation:

```{r}
renamed_df <- all_results_norm %>%    
  select(-c(simulation, distribution, seed, teams)) %>%   
  rename(theta = true_strength, r = true_rank, r_hat = rank_hat, "Wins" = game_wins, "Losses" = game_losses) %>%   
  mutate(theta = round(theta,3)) %>%
  head(8)

# Split into two halves
n <- nrow(renamed_df)
left_table <- renamed_df %>% head(ceiling(n/2))
right_table <- renamed_df %>% tail(floor(n/2))

# Create side-by-side tables
left_html <- left_table %>% 
  kable(format = "html", row.names = FALSE) %>% 
  kableExtra::kable_styling(font_size = 24)
right_html <- right_table %>% 
  kable(format = "html", row.names = FALSE) %>% 
  kableExtra::kable_styling(font_size = 24)

```

::::: columns
::: {.column width="48%"}
```{r}
#| echo: false
left_html
```
:::

::: {.column width="%48%"}
```{r}
#| echo: false
right_html
```
:::
:::::

## Results

:::::: {style="position: relative;"}
::: {.fade-out fragment-index="1"}
```{r out.width="60%", fig.show='hold', fig.align='center'}
knitr::include_graphics("boxed_tournament_comparison_plot.png")
```
:::

::: {.fragment .fade-in .fade-out fragment-index="1" fragment-index="2" style="position: absolute; top: 50%; left: 0; right: 0; transform: translateY(-50%);"}
```{r out.width="60%", fig.show='hold', fig.align='center'}
knitr::include_graphics("tournament_comparison_plot.png")
```
:::

::: {.fragment .fade-in fragment-index="2" style="position: absolute; top: 50%; left: 0; right: 0; transform: translateY(-50%);"}
```{r out.width="60%", fig.show='hold', fig.align='center'}
knitr::include_graphics("tournament_comparison_plot_close.png")
```
:::
::::::

## Conclusion

-   These results underscore the trade-off between tournament accuracy and practical constraints such as time, cost, and entertainment value.
-   Limitations: The "known" strengths are assumptions that can be estimated but never truly known
-   Future Work: Estimate the $\theta$s in a real-world example and compare recent changes to the old format

## References

-   Appleton, David R. 1995. “May the Best Man Win?” Statistician 44 (4): 529.
-   Csato, L. 2021. Tournament Design: How Operations Research Can Improve Sports Rules. 1st Ed. Cham, Switzerland: Palgrave Macmillan.
-   Devriesere, Csató, K., and D. Goossens. 2025. “Tournament Design: A Review from an Operational Research Perspective.” European Journal of Operational Research 324 (1): 1–21.
-   Glenn, W A. 1960. “A Comparison of the Effectiveness of Tournaments.” Biometrika 47 (3-4): 253–62.

## References

-   Guiasu, Silviu. 1977. Information Theory with Applications. New York, NY: McGraw-Hill.
-   Johnson, Sidney, and Rodney Fort. 2022. “Match Outcome Uncertainty and Sports Fan Demand: An Agnostic Review and the Standard Economic Theory of Ports Leagues.” Int. J. Emp. Econ. 01 (02).
-   Lasek, Jan, and Marek Gagolewski. 2018. “The Efficacy of League Formats in Ranking Teams.” Stat. Modelling 18 (5-6): 411–35.
-   Sziklai, Balázs R, Péter Biró, and László Csató. 2022. “The Efficacy of Tournament Designs.” Comput. Oper. Res. 144 (105821): 105821.
